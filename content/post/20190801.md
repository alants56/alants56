+++

date = "2019-08-01"
title = "Pandas.DataFrame 数据处理"
tags = ["Python","Pandas"]


+++




#### 1. 创建pandas.DataFrame

* (1) 创建空的df，然后进行填充

<!--more-->

```Python
df = pd.DataFrame()
df['id'] = [1,1,2]
df['movie'] = ['2012','The Pursuit of Happyness',  'Avatar']
```


* (2) 通过字典初始化DataFrame


```Python
id = [1,1,2]
movie = ['2012','The Pursuit of Happyness',  'Avatar']
df = pd.DataFrame({'id': id, 'movie': movie})
```


结果如下所示：

<table class="is-centered is-striped is-bordered is-narrow">
  <tr>
    <th>id</th>
    <th>movie</th>
  </tr>
  <tr>
    <td>1</td>
    <td>2012</td>
  </tr>
  <tr>
    <td>1</td>
    <td>The Pursuit of Happyness</td>
  </tr>
  <tr>
    <td>2</td>
    <td>Avatar</td>
  </tr>
</table>


#### 2. 修改DataFrame的列名


<table class="is-centered is-striped is-bordered is-narrow">
  <tr>
    <th>0</th>
    <th>1</th>
    <th>2</th>
    <th>3</th>
  </tr>
  <tr>
    <td>1</td>
    <td>2012</td>
    <td>2</td>
    <td>2018-08-22 16:14:24</td>
  </tr>
  <tr>
    <td>1</td>
    <td>The Pursuit of Happyness</td>
    <td>4</td>
    <td>2018-08-28 20:20:32</td>
  </tr>
  <tr>
    <td>2</td>
    <td>Avatar</td>
    <td>3</td>
    <td>2018-08-29 00:40:13</td>
  </tr>
</table>



* (1) 直接修改columns属性

```Python
df.columns = ['id', 'movie', 'score', 'time']
```

* (2) 通过rename修改列名

```Python
df.rename(columns={0: 'id',1:'movie', 2:'score', 3:'time'}, inplace= True)
```

结果如下所示：

<table class="is-centered is-striped is-bordered is-narrow">
  <tr>
    <th>id</th>
    <th>movie</th>
    <th>score</th>
    <th>time</th>
  </tr>
  <tr>
    <td>1</td>
    <td>2012</td>
    <td>2</td>
    <td>2018-08-22 16:14:24</td>
  </tr>
  <tr>
    <td>1</td>
    <td>The Pursuit of Happyness</td>
    <td>4</td>
    <td>2018-08-28 20:20:32</td>
  </tr>
  <tr>
    <td>2</td>
    <td>Avatar</td>
    <td>3</td>
    <td>2018-08-29 00:40:13</td>
  </tr>
</table>


#### 3. 按不同方式访问（遍历）

* (1) 按行和列名访问

```Python
df.loc[0:2, ['movie','score']]
```


* (2) 按第i行和第j列进行访问

```Python
df.iloc[0:2, 1:3]
```


结果如下所示：

<table class="is-centered is-striped is-bordered is-narrow">
  <tr>
    <th>movie</th>
    <th>score</th>
  </tr>
  <tr>
    <td>2012</td>
    <td>2</td>
  </tr>
  <tr>
    <td>The Pursuit of Happyness</td>
    <td>4</td>
  </tr>
</table>


#### 4. 使用特定函数单独处理某列数据

```Python
def is_favorite(x) :
    if x < 3 :
        return "No"
    else :
        return "Yes" 

df['favorite'] = df['score'].map(is_favorite)
```

结果如下所示：

<table class="is-centered is-striped is-bordered is-narrow">
  <tr>
    <th>id</th>
    <th>movie</th>
    <th>score</th>
    <th>time</th>
    <th>favorite</th>
  </tr>
  <tr>
    <td>1</td>
    <td>2012</td>
    <td>2</td>
    <td>2018-08-22 16:14:24</td>
    <td>No</td>
  </tr>
  <tr>
    <td>1</td>
    <td>The Pursuit of Happyness</td>
    <td>4</td>
    <td>2018-08-28 20:20:32</td>
    <td>Yes</td>
  </tr>
  <tr>
    <td>2</td>
    <td>Avatar</td>
    <td>3</td>
    <td>2018-08-29 00:40:13</td>
    <td>Yes</td>
  </tr>
</table>



#### 5. 特定数据按字典进行替换

```Python
swap = {"Yes": 1, "No": 0}
df.replace(swap, inplace=True)
```

结果如下所示：

<table class="is-centered is-striped is-bordered is-narrow">
  <tr>
    <th>id</th>
    <th>movie</th>
    <th>score</th>
    <th>time</th>
    <th>favorite</th>
  </tr>
  <tr>
    <td>1</td>
    <td>2012</td>
    <td>2</td>
    <td>2018-08-22 16:14:24</td>
    <td>0</td>
  </tr>
  <tr>
    <td>1</td>
    <td>The Pursuit of Happyness</td>
    <td>4</td>
    <td>2018-08-28 20:20:32</td>
    <td>1</td>
  </tr>
  <tr>
    <td>2</td>
    <td>Avatar</td>
    <td>3</td>
    <td>2018-08-29 00:40:13</td>
    <td>1</td>
  </tr>
</table>

#### 6. 处理时间类型数据

```Python
t = pd.DatetimeIndex(df['time'])
df['year'] = t.year
df['month'] = t.month
df['day'] = t.day
df['dayofweek'] = t.dayofweek
```


#### 7. 统计某列数据值的分布

* (1) 查看各个值的数目统计

```Python
df['score'].value_counts()
```

* (2) 绘制直方图

```Python
import matplotlib.pyplot as plt
df['score'].value_counts().plot.bar(figsize=(15,10))
plt.show()
```



#### 8. 查看某列数据的缺失率

```Python
df['score'].isnull().mean()
```

#### 9. Nan数据填充

```Python
df['score'].fillna(60, inplace = True)
```


#### 10. 合并DataFrame

* (1) 纵向合并

```Python
df = pd.concat([df1, df2], axis=0,ignore_index=True)
```


* (2) 横向合并

```Python
df = pd.merge(df, df_attr, how='left', on='id')
```



#### 11. 获取满足条件的数据

* (1) 满足某个值

```Python
df.loc[df['is_favorite'] == 0]
```

* (2) 满足某个列表

```Python
ml = ['2012', 'Avatar']
df.loc[df['movie'].isin(ml)]
```

#### 12. 去掉重复出现的数据（保留第一个）

```Python
df.drop_duplicates(subset=['id','movie'], keep='first')
```


&nbsp; &nbsp; &nbsp; &nbsp;以上处理是我最近参加一个推荐系统比赛过程中所使用的Pandas.DataFrame处理数据的方法，详细的函数参数及其使用方法可以通过help函数获取或通过Pandas的官方帮助文档获取。

***

#### 13. 按一定顺序进行排序

```
df.sort_values(['moive','score'])
```


1.参考文档：

&nbsp; &nbsp; &nbsp; &nbsp;[1]. http://pandas.pydata.org/pandas-docs/version/0.24/pandas.pdf