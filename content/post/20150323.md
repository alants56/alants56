---

date : 2015-03-23
title : "配置Linux内核源码树"
tags : ["linux", "内核"]

---


&nbsp; &nbsp; &nbsp; &nbsp; 最近正准备学习《Linux设备驱动程序》，需要搭建内核源码树。
配置内核首先要下载源码，使用命令apt-cache  search linux-source查找源码（所有截图是在win7下的VirtualBox下）。

<!--more-->

![images1](http://liuao.tech/images/2015032301.png)


&nbsp; &nbsp; &nbsp; &nbsp;使用命令`sudo apt-get install linux-source-3.16.0`(版本号是找到的源码的版本号)下载源码，在`usr/src/` 会得到一个名为 linux-source-3.16.0.tar.bz2的压缩文件。

&nbsp; &nbsp; &nbsp; &nbsp;然后跳转路径到`/usr/src/ `下使用`sudo tar jvxf linux-source-3.16.0.tar.bz2`进行解压缩。会得到一个名为`linux-source-3.16.0`的文件夹。

&nbsp; &nbsp; &nbsp; &nbsp;进入`linux-source-3.16.0`文件会看到（有一些隐藏文件没有列出来，其中有一个名为`.config`的文件是一些配置信息，有兴趣可以使用vi .config查看其内容）

![images1](http://liuao.tech/images/2015032302.png)

&nbsp; &nbsp; &nbsp; &nbsp;接下来要进行配置、编译加载等（在该文件路径下，可以通过命令make help，查看其帮助信息）。
&nbsp; &nbsp; &nbsp; &nbsp;首先是`sudo make oldconfig`进行配置（注意要使用root权限，否则会出错）。

![images1](http://liuao.tech/images/2015032303.png)

&nbsp; &nbsp; &nbsp; &nbsp;接着使用`sudo make bzImage`（这一步需要花费很长时间，就是在这一步虚拟机系统非常卡，我只能放弃，重新在我的Ubuntu系统下进行，接下来就不放截图了）。

&nbsp; &nbsp; &nbsp; &nbsp;然后使用`sudo make modules`（这一步也需要花费很长时间）。

&nbsp; &nbsp; &nbsp; &nbsp;最后使用`sudo make modules_install`。

&nbsp; &nbsp; &nbsp; &nbsp;通过上述的步骤就配置成功了，前后差不多需要花费三个小时左右。

&nbsp; &nbsp; &nbsp; &nbsp;接下来就可以加载《Linux设备驱动程序》中的`Hello World`模块。



